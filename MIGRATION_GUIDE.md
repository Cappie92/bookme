# üîÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

> **–í–ê–ñ–ù–û**: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite (`bookme.db`)
**–ú–∏–≥—Ä–∞—Ü–∏–∏:** Alembic (36 –º–∏–≥—Ä–∞—Ü–∏–π)
**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `alembic current`

---

## üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

### **–®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Å—Ä–µ–¥—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 1.1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é backend
cd backend

# 1.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec backend alembic current

# 1.3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker-compose ps
```

### **–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª—è—Ö.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 2.1. –°–æ–∑–¥–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
docker-compose exec backend alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# 2.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
ls -la alembic/versions/ | tail -1

# 2.3. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cat alembic/versions/[–∏–º—è_—Ñ–∞–π–ª–∞].py
```

**–ü—Ä–∏–º–µ—Ä—ã –æ–ø–∏—Å–∞–Ω–∏–π:**
- `"add client_name to bookings"`
- `"add service_duration and service_price fields"`
- `"create master_schedules table"`
- `"add validation for booking conflicts"`

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 3.1. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º SQL, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω
docker-compose exec backend alembic show --sql head

# 3.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
docker-compose exec backend alembic check

# 3.3. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
# nano alembic/versions/[–∏–º—è_—Ñ–∞–π–ª–∞].py
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### **–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 1.1. –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø
docker-compose exec backend cp /app/bookme.db /app/backup_$(date +%Y%m%d_%H%M%S).db

# 1.2. –ö–æ–ø–∏—Ä—É–µ–º –±—ç–∫–∞–ø –Ω–∞ —Ö–æ—Å—Ç
docker-compose cp backend:/app/backup_$(date +%Y%m%d_%H%M%S).db ../backups/

# 1.3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–∞
ls -lh ../backups/backup_*.db | tail -1
```

### **–®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 2.1. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec backend alembic upgrade head

# 2.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å
docker-compose exec backend alembic current

# 2.3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec backend sqlite3 /app/bookme.db "PRAGMA integrity_check;"
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

---

## üîô –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

### **–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 1.1. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec backend alembic history

# 1.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–∫–∞—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω
docker-compose exec backend alembic show --sql -1
```

### **–®–∞–≥ 2: –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ).

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```bash
# 2.1. –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –Ω–∞ –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞–∑–∞–¥
docker-compose exec backend alembic downgrade -1

# 2.2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
docker-compose exec backend alembic current

# 2.3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec backend sqlite3 /app/bookme.db "PRAGMA integrity_check;"
```

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –û—Ç–∫–∞—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö!

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### **–ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–∏–≥—Ä–∞—Ü–∏–π**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ "Multiple heads detected"
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec backend alembic heads

# 2. –°–æ–∑–¥–∞–µ–º merge –º–∏–≥—Ä–∞—Ü–∏—é
docker-compose exec backend alembic merge -m "merge heads" [head1] [head2]

# 3. –ü—Ä–∏–º–µ–Ω—è–µ–º merge –º–∏–≥—Ä–∞—Ü–∏—é
docker-compose exec backend alembic upgrade head
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ "database is locked"
- –û—à–∏–±–∫–∞ "database disk image is malformed"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose down

# 2. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –±—ç–∫–∞–ø–∞
docker-compose up -d
docker-compose exec backend cp /app/backup_YYYYMMDD_HHMMSS.db /app/bookme.db

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
docker-compose exec backend sqlite3 /app/bookme.db "PRAGMA integrity_check;"
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ "Target database is not up to date"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
docker-compose exec backend alembic current

# 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec backend alembic upgrade head

# 3. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é
docker-compose exec backend alembic stamp head
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∏–≥—Ä–∞—Ü–∏–π

### **–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

```bash
# –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
docker-compose exec backend alembic current

# –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec backend alembic history

# –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec backend alembic heads

# –ü—Ä–æ—Å–º–æ—Ç—Ä SQL –º–∏–≥—Ä–∞—Ü–∏–∏
docker-compose exec backend alembic show --sql head

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
docker-compose exec backend sqlite3 /app/bookme.db "PRAGMA integrity_check;"

# –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec backend ls -lh /app/bookme.db
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –≤ dev —Å—Ä–µ–¥–µ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–Ω–æ–º
3. **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ** —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** —Å–ª–æ–∂–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs backend`
2. –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø
3. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** $(date)
**–í–µ—Ä—Å–∏—è:** 1.0
