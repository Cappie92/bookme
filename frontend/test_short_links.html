<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –∏–∑ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background-color: #0056b3;
        }
        .example-links {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .example-link {
            display: block;
            margin: 5px 0;
            padding: 5px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            cursor: pointer;
        }
        .link-type {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
        }
        .method-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .method-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .method-card h3 {
            margin-top: 0;
            color: #333;
        }
        .pros-cons {
            margin: 10px 0;
        }
        .pros-cons ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        .pros-cons li {
            margin: 2px 0;
        }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –∏–∑ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫</h1>
    
    <div class="test-section">
        <h2>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤</h2>
        <div class="method-comparison">
            <div class="method-card">
                <h3>üîÑ –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥</h3>
                <div class="pros-cons">
                    <strong>–ü—Ä–æ–±–ª–µ–º—ã:</strong>
                    <ul>
                        <li>–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏</li>
                        <li>–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∞—Å—Ç—å URL –≤–º–µ—Å—Ç–æ –∞–¥—Ä–µ—Å–∞</li>
                        <li>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</li>
                    </ul>
                </div>
            </div>
            <div class="method-card">
                <h3>‚úÖ –ù–æ–≤—ã–π –º–µ—Ç–æ–¥</h3>
                <div class="pros-cons">
                    <strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong>
                    <ul>
                        <li>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã —Å—Å—ã–ª–æ–∫</li>
                        <li>–í–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫</li>
                        <li>–û–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
                        <li>–¢–æ—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>–¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞</h2>
        <p>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞:</p>
        <input type="text" id="yandexLink" placeholder="https://yandex.ru/maps/...">
        <button onclick="extractAddress()">–ò–∑–≤–ª–µ—á—å –∞–¥—Ä–µ—Å</button>
        <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div id="extractionResult"></div>
    </div>

    <div class="test-section">
        <h2>–ü—Ä–∏–º–µ—Ä—ã —Å—Å—ã–ª–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div class="example-links">
            <p><strong>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong></p>
            
            <div class="link-type">‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è - –ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å –∞–¥—Ä–µ—Å–æ–º</div>
            <div class="example-link" onclick="testLink(this.textContent)">
                https://yandex.ru/maps/213/moscow/?ll=37.617635%2C55.755814&z=16&text=—É–ª–∏—Ü–∞%20–¢–≤–µ—Ä—Å–∫–∞—è%2C%201
            </div>
            
            <div class="link-type">‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è - –ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏</div>
            <div class="example-link" onclick="testLink(this.textContent)">
                https://yandex.ru/maps/213/moscow/?ll=37.617635%2C55.755814&z=16
            </div>
            
            <div class="link-type">‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è - –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ (–Ω–æ–≤—ã–π –º–µ—Ç–æ–¥)</div>
            <div class="example-link" onclick="testLink(this.textContent)">
                https://yandex.ru/maps/-/CHXXEC87
            </div>
            
            <div class="link-type">‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è - –¥—Ä—É–≥–∞—è –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞</div>
            <div class="example-link" onclick="testLink(this.textContent)">
                https://yandex.ru/maps/-/CCUu8XeB
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥</h2>
        <ol>
            <li><strong>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Å—ã–ª–∫–∏:</strong> –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç URL –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞</li>
            <li><strong>–û–±—ã—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</strong> –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∞–¥—Ä–µ—Å –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–ª–∏ –ø—É—Ç–∏</li>
            <li><strong>–ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏:</strong> –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ –∏ –ø–∞—Ä—Å–∏—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
            <li><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
            <li><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å</li>
        </ol>
        
        <div class="warning" style="margin-top: 10px; padding: 10px;">
            <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API —Å –≤–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥–æ–º. 
            –§—Ä–æ–Ω—Ç–µ–Ω–¥-–≤–µ—Ä—Å–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ CORS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏.
        </div>
    </div>

    <script>
        async function extractAddressFromYandexLink(url) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã
                if (!url.includes('yandex.ru/maps') && !url.includes('maps.yandex.ru')) {
                    return { error: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã' }
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–æ–π
                if (url.includes('/maps/-/')) {
                    return { 
                        error: '–ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ —Ç—Ä–µ–±—É—é—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ServerBasedAddressExtractor –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.',
                        isShortLink: true
                    }
                }

                const urlObj = new URL(url)
                const path = urlObj.pathname
                
                // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∞–¥—Ä–µ—Å –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å—Å—ã–ª–æ–∫
                let address = null

                // –§–æ—Ä–º–∞—Ç 1: /maps/213/moscow/?ll=37.617635%2C55.755814&z=16&text=—É–ª–∏—Ü–∞%20–¢–≤–µ—Ä—Å–∫–∞—è%2C%201
                const textParam = urlObj.searchParams.get('text')
                if (textParam) {
                    address = decodeURIComponent(textParam)
                }

                // –§–æ—Ä–º–∞—Ç 2: /maps/213/moscow/?ll=37.617635%2C55.755814&z=16
                // –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∏–∑ path
                if (!address) {
                    const pathParts = path.split('/')
                    if (pathParts.length >= 4) {
                        // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∞–¥—Ä–µ—Å –≤ path
                        const possibleAddress = pathParts.slice(3).join('/')
                        if (possibleAddress && 
                            possibleAddress !== 'moscow' && 
                            possibleAddress !== 'spb' && 
                            possibleAddress !== 'saint-petersburg' &&
                            !possibleAddress.match(/^\d+$/) &&
                            !possibleAddress.startsWith('-/')) {
                            address = decodeURIComponent(possibleAddress)
                        }
                    }
                }

                if (address) {
                    // –û—á–∏—â–∞–µ–º –∞–¥—Ä–µ—Å –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
                    address = address
                        .replace(/\+/g, ' ')
                        .replace(/\s+/g, ' ')
                        .trim()
                    
                    return { success: true, address: address }
                } else {
                    return { error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –∞–¥—Ä–µ—Å –∏–∑ —Å—Å—ã–ª–∫–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Å—ã–ª–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–¥—Ä–µ—Å –∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.' }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Å—ã–ª–∫–∏:', error)
                return { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å—Å—ã–ª–∫–∏' }
            }
        }

        async function extractAddress() {
            const input = document.getElementById('yandexLink')
            const resultDiv = document.getElementById('extractionResult')
            
            if (!input.value) {
                resultDiv.innerHTML = '<div class="error">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</div>'
                return
            }

            resultDiv.innerHTML = '<div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>'

            const result = await extractAddressFromYandexLink(input.value)
            
            if (result.error) {
                if (result.isShortLink) {
                    resultDiv.innerHTML = `
                        <div class="warning">
                            <strong>–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞!</strong><br>
                            ${result.error}<br><br>
                            <strong>–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:</strong><br>
                            ‚Ä¢ ServerBasedAddressExtractor –∫–æ–º–ø–æ–Ω–µ–Ω—Ç<br>
                            ‚Ä¢ –°–µ—Ä–≤–µ—Ä–Ω—ã–π API —Å –≤–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥–æ–º
                        </div>
                    `
                } else {
                    resultDiv.innerHTML = `<div class="error">${result.error}</div>`
                }
            } else {
                resultDiv.innerHTML = `
                    <div class="success">
                        <strong>–£—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω –∞–¥—Ä–µ—Å:</strong><br>
                        ${result.address}
                    </div>
                `
            }
        }

        function testLink(link) {
            document.getElementById('yandexLink').value = link
            extractAddress()
        }

        function clearResults() {
            document.getElementById('yandexLink').value = ''
            document.getElementById('extractionResult').innerHTML = ''
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏
        document.getElementById('yandexLink').addEventListener('input', function(e) {
            const value = e.target.value
            if (value.includes('yandex.ru/maps') || value.includes('maps.yandex.ru')) {
                setTimeout(extractAddress, 500) // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å—Ç–∞–≤–∫–∏
            }
        })
    </script>
</body>
</html> 