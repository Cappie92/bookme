#!/usr/bin/env python3
"""
Скрипт для добавления тестовых статей в блог
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from datetime import datetime, timedelta
from database import SessionLocal, engine
from models import Base, BlogPost, User, BlogPostStatus
from utils.seo import generate_slug

# Создаем таблицы
Base.metadata.create_all(bind=engine)

def create_test_posts():
    db = SessionLocal()
    
    try:
        # Получаем первого пользователя как автора
        author = db.query(User).first()
        if not author:
            print("Ошибка: Нет пользователей в базе данных")
            return
        
        # Тестовые статьи
        test_posts = [
            {
                "title": "Как правильно ухаживать за кожей лица",
                "subtitle": "Полное руководство по уходу за кожей в домашних условиях",
                "excerpt": "Узнайте основные принципы ухода за кожей лица, правильный порядок нанесения средств и секреты здоровой кожи.",
                "content": """
                <h2>Основы ухода за кожей</h2>
                <p>Правильный уход за кожей лица начинается с понимания типа вашей кожи. Существует четыре основных типа кожи:</p>
                <ul>
                    <li><strong>Нормальная кожа</strong> - хорошо сбалансированная, без излишней жирности или сухости</li>
                    <li><strong>Сухая кожа</strong> - часто шелушится, может быть стянутой</li>
                    <li><strong>Жирная кожа</strong> - имеет избыточное выделение кожного сала</li>
                    <li><strong>Комбинированная кожа</strong> - сочетает в себе признаки разных типов</li>
                </ul>
                
                <h2>Правильный порядок ухода</h2>
                <p>Основные этапы ухода за кожей:</p>
                <ol>
                    <li><strong>Очищение</strong> - удаление макияжа и загрязнений</li>
                    <li><strong>Тонизирование</strong> - восстановление pH баланса</li>
                    <li><strong>Увлажнение</strong> - насыщение кожи влагой</li>
                    <li><strong>Защита</strong> - нанесение солнцезащитного крема</li>
                </ol>
                
                <h2>Секреты здоровой кожи</h2>
                <p>Помимо правильного ухода, важно:</p>
                <ul>
                    <li>Пить достаточное количество воды</li>
                    <li>Высыпаться и избегать стресса</li>
                    <li>Правильно питаться</li>
                    <li>Защищать кожу от солнца</li>
                </ul>
                """,
                "tags": ["уход за кожей", "красота", "здоровье"],
                "reading_time": 5,
                "word_count": 250
            },
            {
                "title": "Тренды макияжа 2024 года",
                "subtitle": "Самые популярные техники и цвета сезона",
                "excerpt": "Обзор главных трендов в макияже 2024 года - от натуральных образов до смелых экспериментов с цветом.",
                "content": """
                <h2>Натуральная красота</h2>
                <p>В 2024 году главный тренд - это естественная красота. Моделирование лица становится более тонким, а акцент делается на здоровом сиянии кожи.</p>
                
                <h2>Цветовые тренды</h2>
                <p>Популярные цвета сезона:</p>
                <ul>
                    <li><strong>Терракотовые оттенки</strong> - для губ и скул</li>
                    <li><strong>Лавандовые тени</strong> - для создания нежных образов</li>
                    <li><strong>Металлические акценты</strong> - для вечерних образов</li>
                </ul>
                
                <h2>Техники макияжа</h2>
                <p>Современные техники включают:</p>
                <ol>
                    <li>Многослойное нанесение тона</li>
                    <li>Точечное контурирование</li>
                    <li>Градиентные брови</li>
                    <li>Объемные ресницы</li>
                </ol>
                """,
                "tags": ["макияж", "тренды", "красота"],
                "reading_time": 4,
                "word_count": 200
            },
            {
                "title": "Польза массажа для здоровья",
                "subtitle": "Как массаж влияет на организм и психику",
                "excerpt": "Откройте для себя многочисленные преимущества массажа - от снятия стресса до улучшения кровообращения.",
                "content": """
                <h2>Виды массажа</h2>
                <p>Существует множество видов массажа, каждый со своими преимуществами:</p>
                <ul>
                    <li><strong>Классический массаж</strong> - улучшает кровообращение</li>
                    <li><strong>Расслабляющий массаж</strong> - снимает стресс и напряжение</li>
                    <li><strong>Спортивный массаж</strong> - помогает в восстановлении мышц</li>
                    <li><strong>Точечный массаж</strong> - воздействует на активные точки</li>
                </ul>
                
                <h2>Польза для здоровья</h2>
                <p>Регулярный массаж помогает:</p>
                <ol>
                    <li>Снизить уровень стресса</li>
                    <li>Улучшить качество сна</li>
                    <li>Уменьшить мышечное напряжение</li>
                    <li>Улучшить кровообращение</li>
                    <li>Укрепить иммунную систему</li>
                </ol>
                
                <h2>Как часто делать массаж</h2>
                <p>Для поддержания здоровья рекомендуется делать массаж 1-2 раза в месяц. При наличии проблем со здоровьем - по назначению специалиста.</p>
                """,
                "tags": ["массаж", "здоровье", "релаксация"],
                "reading_time": 6,
                "word_count": 300
            },
            {
                "title": "Правильное питание для красивой кожи",
                "subtitle": "Какие продукты помогают сохранить молодость и красоту",
                "excerpt": "Узнайте, какие продукты питания способствуют здоровью кожи и помогают сохранить молодость.",
                "content": """
                <h2>Витамины для кожи</h2>
                <p>Ключевые витамины для здоровья кожи:</p>
                <ul>
                    <li><strong>Витамин A</strong> - способствует обновлению клеток</li>
                    <li><strong>Витамин C</strong> - антиоксидант, защищает от старения</li>
                    <li><strong>Витамин E</strong> - увлажняет и защищает</li>
                    <li><strong>Витамин D</strong> - важен для иммунитета кожи</li>
                </ul>
                
                <h2>Полезные продукты</h2>
                <p>Включите в рацион:</p>
                <ol>
                    <li>Жирную рыбу (лосось, скумбрия)</li>
                    <li>Орехи и семена</li>
                    <li>Зеленые овощи</li>
                    <li>Ягоды и фрукты</li>
                    <li>Цельнозерновые продукты</li>
                </ol>
                
                <h2>Продукты, которых стоит избегать</h2>
                <p>Для здоровья кожи ограничьте:</p>
                <ul>
                    <li>Сахар и сладости</li>
                    <li>Жареную пищу</li>
                    <li>Алкоголь</li>
                    <li>Обработанные продукты</li>
                </ul>
                """,
                "tags": ["питание", "здоровье", "кожа"],
                "reading_time": 7,
                "word_count": 350
            },
            {
                "title": "Стрижки для разных типов лица",
                "subtitle": "Как выбрать идеальную стрижку под форму лица",
                "excerpt": "Руководство по выбору стрижки в зависимости от формы лица - от овального до квадратного.",
                "content": """
                <h2>Определение формы лица</h2>
                <p>Перед выбором стрижки важно определить форму лица:</p>
                <ul>
                    <li><strong>Овальное лицо</strong> - универсальная форма</li>
                    <li><strong>Круглое лицо</strong> - нужны объемные стрижки</li>
                    <li><strong>Квадратное лицо</strong> - мягкие линии</li>
                    <li><strong>Сердцевидное лицо</strong> - баланс в нижней части</li>
                </ul>
                
                <h2>Рекомендации по стрижкам</h2>
                <p>Для каждой формы лица:</p>
                <ol>
                    <li><strong>Овальное лицо</strong> - подходят любые стрижки</li>
                    <li><strong>Круглое лицо</strong> - асимметричные и многослойные</li>
                    <li><strong>Квадратное лицо</strong> - мягкие волны и локоны</li>
                    <li><strong>Сердцевидное лицо</strong> - объем в нижней части</li>
                </ol>
                
                <h2>Советы стилиста</h2>
                <p>При выборе стрижки учитывайте:</p>
                <ul>
                    <li>Текстуру волос</li>
                    <li>Образ жизни</li>
                    <li>Время на укладку</li>
                    <li>Личные предпочтения</li>
                </ul>
                """,
                "tags": ["стрижки", "стиль", "красота"],
                "reading_time": 5,
                "word_count": 280
            }
        ]
        
        # Создаем статьи
        for i, post_data in enumerate(test_posts):
            # Проверяем, существует ли уже статья с таким slug
            slug = generate_slug(post_data["title"])
            existing_post = db.query(BlogPost).filter(BlogPost.slug == slug).first()
            
            if existing_post:
                print(f"Статья '{post_data['title']}' уже существует, пропускаем")
                continue
            
            # Создаем новую статью
            post = BlogPost(
                title=post_data["title"],
                subtitle=post_data["subtitle"],
                excerpt=post_data["excerpt"],
                content=post_data["content"],
                tags=post_data["tags"],
                reading_time=post_data["reading_time"],
                word_count=post_data["word_count"],
                author_id=author.id,
                status=BlogPostStatus.PUBLISHED,
                published_at=datetime.utcnow() - timedelta(days=i*2),  # Разные даты публикации
                slug=slug,
                meta_title=post_data["title"],
                meta_description=post_data["excerpt"],
                og_title=post_data["title"],
                og_description=post_data["excerpt"],
                twitter_title=post_data["title"],
                twitter_description=post_data["excerpt"]
            )
            
            db.add(post)
            print(f"Создана статья: {post_data['title']}")
        
        db.commit()
        print(f"Успешно создано {len(test_posts)} тестовых статей")
        
    except Exception as e:
        print(f"Ошибка при создании статей: {e}")
        db.rollback()
    finally:
        db.close()

if __name__ == "__main__":
    create_test_posts() 